#!/usr/bin/env python

import re
import sys
from argparse import ArgumentParser


def main(args):
    try:
        content = open(args.filename).read()
        # print args

        # extract info tags from source file
        mtitle = re.search('<template-title>(.*)</template-title>', content)
        # print 1, mtitle
        title = mtitle.groups()[0]
        title_tag = mtitle.group()
        print 'title:', title, title_tag

        mfilename = re.search('<template-filename>(.*)</template-filename>', content)
        # print 3, mfilename
        filename = mfilename.groups()[0]
        filename_tag = mfilename.group()
        print 'filename:', filename, filename_tag

        # now erase info tags
        content = content.replace(filename_tag, '')
        content = content.replace(title_tag, '')

        # create compiled html file
        frame_file = args.parent #'./app/html_templates/frame.html'
        frame = open(frame_file).read()
        full = frame.replace('[[title]]', title).replace('[[content]]', content)

        dest = open(args.destination + '/' + filename, 'w')
        dest.write(full)
        dest.close()
    except AttributeError as e:
        print e
        sys.exit(1)

    sys.exit()


if __name__ == '__main__':

    parser = ArgumentParser (description='Compile html')

    parser.add_argument(
        'filename',
        help='Source filename',
        )
    parser.add_argument(
        'parent',
        help='Parent template to combine with filename',
        )
    parser.add_argument(
        'destination',
        help='Destination for compiled html',
        )

    args = parser.parse_args()
    main(args)
